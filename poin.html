<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#4A0A13" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Poin â€” Beloved Kids Cito</title>
  <link rel="icon" type="image/x-icon" href="BK Cito.jpeg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="poin.css" />
</head>
<body>

  <div class="bg-bubbles" aria-hidden="true">
    <span></span><span></span><span></span><span></span><span></span>
  </div>

  <!-- LOADING -->
  <div class="loading-overlay" id="loadingOverlay" role="status" aria-live="polite">
    <div class="loading-spinner"></div>
    <p id="loadingMsg">Memuat data...</p>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast" role="alert" aria-live="assertive"></div>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <div class="logo-wrap">
        <img src="BK Cito.jpeg" alt="Beloved Kids Cito" class="site-logo" />
      </div>
      <div class="header-text">
        <div class="header-date" id="headerDate"></div>
        <h1 class="header-title">Beloved Kids Cito</h1>
        <p class="header-tagline">Sistem Poin Jemaat Anak</p>
      </div>
      <button class="help-btn" onclick="openPoinHelp()" aria-label="Panduan penggunaan">?</button>
    </div>
    <div class="header-ring" aria-hidden="true"></div>
  </header>

  <!-- MAIN -->
  <main class="main-content">

    <!-- NAV BALIK -->
    <div class="back-bar">
      <a href="index.html" class="back-btn">&#8592; Absensi</a>
      <div class="year-badge" id="yearBadge"></div>
    </div>

    <!-- TAB KELAS -->
    <nav class="tab-nav" role="tablist" aria-label="Pilih Kelas">
      <button class="tab-btn active" id="ptab-semua" role="tab" onclick="switchPoinTab('semua')">
        <span class="tab-icon">ğŸ†</span>
        <span class="tab-label">Semua</span>
        <span class="tab-sub">All Kelas</span>
      </button>
      <button class="tab-btn" id="ptab-kecil"  role="tab" onclick="switchPoinTab('kecil')">
        <span class="tab-icon">ğŸ£</span>
        <span class="tab-label">Kecil</span>
        <span class="tab-sub">3â€“6 thn</span>
      </button>
      <button class="tab-btn" id="ptab-tengah" role="tab" onclick="switchPoinTab('tengah')">
        <span class="tab-icon">ğŸŒ¿</span>
        <span class="tab-label">Tengah</span>
        <span class="tab-sub">7â€“9 thn</span>
      </button>
      <button class="tab-btn" id="ptab-besar"  role="tab" onclick="switchPoinTab('besar')">
        <span class="tab-icon">â­</span>
        <span class="tab-label">Besar</span>
        <span class="tab-sub">10+ thn</span>
      </button>
    </nav>

    <!-- PANEL per kelas -->
    <div id="poin-panel" class="poin-panel-wrap">
      <!-- Dirender oleh JS -->
    </div>

  </main>

  <!-- MODAL: BERI POIN -->
  <div class="modal-overlay" id="poinModal" onclick="if(event.target===this)closePoinModal()">
    <div class="modal-box poin-modal-box">
      <div class="modal-header">
        <div class="poin-modal-avatar" id="poinModal-avatar"></div>
        <div>
          <h3 class="modal-title" id="poinModal-nama"></h3>
          <p class="modal-sub">Total poin: <strong id="poinModal-total"></strong></p>
        </div>
        <button class="modal-close" onclick="closePoinModal()">âœ•</button>
      </div>

      <p class="poin-modal-label">Pilih aktivitas (bisa lebih dari satu):</p>
      <div class="aktivitas-grid" id="aktivitasGrid">
        <!-- Dirender JS -->
      </div>

      <!-- Submit bar aktivitas -->
      <div class="poin-submit-bar" id="poinSubmitBar">
        <span class="poin-submit-info">
          <span id="poinSubmitCount">0</span> aktivitas dipilih
        </span>
        <button class="btn btn-primary poin-submit-btn" onclick="submitAktivitasPoin()">
          Tambah Poin
        </button>
      </div>


    </div>
  </div>

  <!-- MODAL: HELP -->
  <div class="modal-overlay" id="poinHelpModal" onclick="if(event.target===this)closePoinHelp()">
    <div class="modal-box help-modal-box" role="dialog" aria-modal="true" aria-label="Panduan Poin">

      <div class="help-header">
        <div class="help-header-text">
          <div class="help-icon">ğŸ…</div>
          <div>
            <h3 class="modal-title">Panduan Poin</h3>
            <p class="modal-sub">Beloved Kids Cito</p>
          </div>
        </div>
        <button class="modal-close" onclick="closePoinHelp()">âœ•</button>
      </div>

      <div class="help-tabs">
        <button class="help-tab active" onclick="switchPoinHelp('cara', this)">ğŸ† Cara Pakai</button>
        <button class="help-tab" onclick="switchPoinHelp('filter', this)">ğŸ“… Filter</button>
        <button class="help-tab" onclick="switchPoinHelp('kelola', this)">âš™ï¸ Kelola</button>
      </div>

      <div class="help-content">

        <!-- Panel: Cara Pakai -->
        <div class="help-panel active" id="phelp-cara">
          <div class="help-section">
            <p class="help-lead">Cara memberikan poin ke anak dalam 3 langkah.</p>

            <div class="help-step">
              <div class="help-step-num">1</div>
              <div>
                <div class="help-step-title">Ketuk Nama Anak</div>
                <div class="help-step-desc">Ketuk kartu nama di papan peringkat untuk membuka modal poin anak tersebut.</div>
              </div>
            </div>
            <div class="help-step">
              <div class="help-step-num">2</div>
              <div>
                <div class="help-step-title">Pilih Aktivitas</div>
                <div class="help-step-desc">Ketuk satu atau lebih aktivitas yang dilakukan anak. Kartu yang dipilih akan ter-highlight. Setiap aktivitas bernilai <strong>+1 poin</strong>.</div>
              </div>
            </div>
            <div class="help-step">
              <div class="help-step-num">3</div>
              <div>
                <div class="help-step-title">Ketuk Tambah Poin</div>
                <div class="help-step-desc">Bar kuning di bawah menampilkan jumlah aktivitas yang dipilih. Ketuk <strong>Tambah Poin</strong> untuk menyimpan.</div>
              </div>
            </div>

            <div class="help-note">
              <span class="help-note-icon">ğŸ’¡</span>
              <span>Poin tersimpan otomatis ke Google Sheets dan papan peringkat langsung terupdate.</span>
            </div>
          </div>
        </div>

        <!-- Panel: Filter -->
        <div class="help-panel" id="phelp-filter">
          <div class="help-section">
            <p class="help-lead">Filter papan peringkat berdasarkan periode waktu.</p>

            <div class="help-item">
              <div class="help-item-icon">ğŸ“Š</div>
              <div>
                <div class="help-item-title">Semua</div>
                <div class="help-item-desc">Tampilkan total poin kumulatif sejak awal â€” tidak terbatas waktu.</div>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">ğŸ“…</div>
              <div>
                <div class="help-item-title">Tahun Ini / Bulan Ini / Minggu Ini</div>
                <div class="help-item-desc">Hanya menghitung poin yang diperoleh dalam periode tersebut. Data diambil dari log transaksi poin (<strong>Poin_Log</strong> di Google Sheets).</div>
              </div>
            </div>

            <div class="help-note">
              <span class="help-note-icon">ğŸ“¦</span>
              <span>Filter per periode hanya berlaku untuk poin yang dicatat <strong>setelah fitur ini diaktifkan</strong>. Poin lama tidak memiliki histori tanggal.</span>
            </div>
          </div>
        </div>

        <!-- Panel: Kelola -->
        <div class="help-panel" id="phelp-kelola">
          <div class="help-section">
            <p class="help-lead">Kelola aktivitas dan reset poin tahunan.</p>

            <div class="help-item">
              <div class="help-item-icon">â•</div>
              <div>
                <div class="help-item-title">Tambah Aktivitas Custom</div>
                <div class="help-item-desc">Di dalam modal poin, ketuk <strong>Tambah Aktivitas</strong> â†’ isi nama dan pilih emoji â†’ Simpan. Aktivitas baru muncul di semua anak.</div>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">ğŸ—‘ï¸</div>
              <div>
                <div class="help-item-title">Hapus Aktivitas Custom</div>
                <div class="help-item-desc">Buka Google Sheets â†’ sheet <strong>Aktivitas</strong> â†’ hapus baris yang tidak diperlukan. Aktivitas default (Mimpin Doa, Kesaksian, Jawab Kuis) tidak bisa dihapus dari sini.</div>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">ğŸ”„</div>
              <div>
                <div class="help-item-title">Reset Poin Tahunan</div>
                <div class="help-item-desc">Ketuk <strong>Reset Tahun</strong> di pojok kanan panel. Semua poin direset ke 0, tapi data lama otomatis diarsipkan ke sheet <strong>Poin_Arsip</strong> â€” tidak hilang permanen.</div>
              </div>
            </div>

            <div class="help-note">
              <span class="help-note-icon">âš ï¸</span>
              <span>Reset poin tidak bisa diurungkan dari aplikasi. Pastikan sudah yakin sebelum reset.</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- MODAL: TAMBAH AKTIVITAS -->
  <div class="modal-overlay" id="addAktModal" onclick="if(event.target===this)closeAddAktModal()">
    <div class="modal-box" style="max-width:360px">
      <div class="modal-header">
        <div>
          <h3 class="modal-title">Tambah Aktivitas</h3>
          <p class="modal-sub">Aktivitas baru akan muncul di semua kelas</p>
        </div>
        <button class="modal-close" onclick="closeAddAktModal()">âœ•</button>
      </div>

      <div class="form-group" style="margin-top:16px">
        <label class="poin-modal-label" for="newAktNama">Nama Aktivitas</label>
        <input type="text" id="newAktNama" class="form-input"
          placeholder="cth: Hafal Ayat, Bawa Alkitab..."
          autocomplete="off" autocapitalize="words"
          onkeydown="if(event.key==='Enter')document.getElementById('newAktIcon').focus()" />
      </div>

      <div class="form-group" style="margin-top:12px">
        <label class="poin-modal-label" for="newAktIcon">Emoji / Icon</label>
        <div class="akt-icon-row">
          <input type="text" id="newAktIcon" class="form-input akt-icon-input"
            placeholder="ğŸŒŸ"
            onkeydown="if(event.key==='Enter')saveNewAktivitas()" />
          <div class="akt-icon-presets">
            <button onclick="pickIcon('ğŸ“–')">ğŸ“–</button>
            <button onclick="pickIcon('ğŸ¤')">ğŸ¤</button>
            <button onclick="pickIcon('ğŸŒŸ')">ğŸŒŸ</button>
            <button onclick="pickIcon('ğŸ†')">ğŸ†</button>
            <button onclick="pickIcon('â¤ï¸')">â¤ï¸</button>
            <button onclick="pickIcon('âœï¸')">âœï¸</button>
          </div>
        </div>
      </div>

      <div class="confirm-actions" style="margin-top:20px">
        <button class="btn btn-ghost" onclick="closeAddAktModal()">Batal</button>
        <button class="btn btn-primary" onclick="saveNewAktivitas()" style="flex:1.5">Simpan Aktivitas</button>
      </div>
    </div>
  </div>

  <!-- MODAL: KONFIRMASI RESET -->
  <div class="modal-overlay" id="resetModal" onclick="if(event.target===this)closeResetModal()">
    <div class="modal-box confirm-modal-box">
      <div class="confirm-icon-wrap">ğŸ”„</div>
      <h3 class="confirm-title">Reset Poin <span id="resetModal-tahun"></span>?</h3>
      <div class="confirm-body">
        Semua poin anak di <strong>seluruh kelas</strong> akan direset ke 0.<br><br>
        Riwayat poin tahun ini akan disimpan di sheet <strong>Poin_Arsip</strong> sebelum direset.
      </div>
      <div class="confirm-actions">
        <button class="btn btn-ghost" onclick="closeResetModal()">Batal</button>
        <button class="btn btn-danger" onclick="doResetPoin()" style="min-height:50px;flex:1.6">Reset Sekarang</button>
      </div>
    </div>
  </div>

  <script src="poin.js"></script>
</body>
</html>